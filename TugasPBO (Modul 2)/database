-- Setup Database untuk Sistem Manajemen Mahasiswa dengan PostgreSQL
-- Jalankan script ini di PostgreSQL untuk membuat database dan tabel

-- Buat database (jalankan sebagai superuser)
-- CREATE DATABASE sistem_mahasiswa;

-- Connect ke database
\c sistem_mahasiswa;

-- Hapus tabel jika sudah ada (untuk fresh start)
DROP TABLE IF EXISTS nilai CASCADE;
DROP TABLE IF EXISTS mata_kuliah CASCADE;
DROP TABLE IF EXISTS mahasiswa CASCADE;
DROP TABLE IF EXISTS jurusan CASCADE;

-- Buat tabel jurusan
CREATE TABLE jurusan (
    kode VARCHAR(10) PRIMARY KEY,
    nama VARCHAR(100) NOT NULL
);

-- Buat tabel mata kuliah
CREATE TABLE mata_kuliah (
    kode VARCHAR(10) PRIMARY KEY,
    nama VARCHAR(100) NOT NULL,
    sks INTEGER NOT NULL,
    kode_jurusan VARCHAR(10),
    FOREIGN KEY (kode_jurusan) REFERENCES jurusan(kode) ON DELETE CASCADE
);

-- Buat tabel mahasiswa
CREATE TABLE mahasiswa (
    nim VARCHAR(20) PRIMARY KEY,
    nama VARCHAR(100) NOT NULL,
    kode_jurusan VARCHAR(10),
    FOREIGN KEY (kode_jurusan) REFERENCES jurusan(kode) ON DELETE SET NULL
);

-- Buat tabel nilai
CREATE TABLE nilai (
    id SERIAL PRIMARY KEY,
    nim VARCHAR(20),
    kode_mata_kuliah VARCHAR(10),
    indeks_nilai CHAR(1) CHECK (indeks_nilai IN ('A', 'B', 'C', 'D', 'E')),
    FOREIGN KEY (nim) REFERENCES mahasiswa(nim) ON DELETE CASCADE,
    FOREIGN KEY (kode_mata_kuliah) REFERENCES mata_kuliah(kode) ON DELETE CASCADE,
    UNIQUE (nim, kode_mata_kuliah)
);

-- Insert data sample (opsional)
INSERT INTO jurusan (kode, nama) VALUES 
('TI', 'Teknik Informatika'),
('SI', 'Sistem Informasi'),
('MI', 'Manajemen Informatika');

INSERT INTO mata_kuliah (kode, nama, sks, kode_jurusan) VALUES 
('PBO', 'Pemrograman Berorientasi Objek', 3, 'TI'),
('DBS', 'Database System', 3, 'TI'),
('WEB', 'Pemrograman Web', 3, 'TI'),
('ALGO', 'Algoritma dan Struktur Data', 3, 'TI'),
('JARKOM', 'Jaringan Komputer', 3, 'TI');

-- Tampilkan pesan sukses
SELECT 'Database dan tabel berhasil dibuat!' as Status;
SELECT 'Data sample berhasil dimasukkan!' as Status;
